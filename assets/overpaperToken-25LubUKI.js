import{r,j as e}from"./index-Bew0CJxr.js";import{I,B as S,S as _,J as E,A as G,W as J,C as A,a as b,G as K,b as L}from"./CardNFT-BOUXb_4i.js";import{R as c}from"./RespondFactory2-Bcetu96i.js";const H=()=>{const[o,C]=r.useState(""),[i,P]=r.useState(""),[R,y]=r.useState(new Map),[k,p]=r.useState(!1),[$,f]=r.useState(0),[B,j]=r.useState(!1),M=s=>{C(s.trim()),N()},T=s=>{P(s.trim())},N=()=>{y(new Map),f(0)},F=async()=>{var g;p(!0),j(!1);const s=new E(G),t=new J(o,s),d=new A(c.address,c.abi,t),x=new A(b.address,b.abi,t);await x.isApprovedForAll(t.address,c.address)?console.log(`${t.address} 已授权`):(await x.setApprovalForAll(c.address,!0),console.log(`${t.address} 授权完成`));const w=await v(t.address,0),n=new Map;for(let a=0;a<w.length;a++){const h=Number(w[a].tokenId),m=Math.floor(a/10);n.has(m)?(g=n.get(m))==null||g.push(h):n.set(m,[h])}y(n),console.log(n);let u=0;for(const a of n.values()){if(B){p(!1);break}u++,await(await d.respondBtch(a,i,!0)).wait(),f(u),console.log(`${u} ${t.address} ->  ${a.length} ${a[a.length-1]}`)}p(!1)},v=async(s,t=0)=>new Promise(async d=>{const l=await(await fetch(K,{method:"POST",headers:{"Content-Type":"application/json",authorization:`Bearer ${L}`},body:JSON.stringify({query:`query MyQuery {
            papers(
              first: 1000
              orderBy: createAt
              skip: ${t}
              where: {user: "${s}", type: 0}
            ) {
              tokenId
            }
          }`})})).json();l.data.papers.length<1e3?d(l.data.papers):d(l.data.papers.concat(await v(s,t+1e3)))});return e.jsxs("div",{children:[e.jsxs("div",{className:"space-y-[20px]",children:[e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("div",{className:"mb-5 text-[20px]",children:"拿币"}),e.jsx("div",{children:"私钥"}),e.jsx(I,{value:o,onChange:s=>M(s.target.value),style:{width:"400px"}})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("div",{children:"接收地址"}),e.jsx(I,{value:i,onChange:s=>T(s.target.value),style:{width:"400px"}})]})]}),e.jsxs("div",{children:[e.jsxs(S,{style:{width:"100px"},disabled:o==""||i=="",type:"primary",onClick:F,loading:k,children:[" ","开始答题"]}),e.jsxs(S,{style:{marginLeft:"20px",width:"100px"},disabled:o==""||i=="",type:"primary",onClick:()=>j(!0),children:[" ","暂停"]}),e.jsx("ul",{style:{marginTop:"20px"},children:e.jsx("ul",{children:Array.from(R,([s,t])=>e.jsxs("li",{children:[e.jsxs("div",{children:[e.jsxs("span",{style:{fontSize:"16px"},children:["第",s+1,"组"]}),": ",t.join(", ")]}),$<=s?e.jsx("div",{children:e.jsx(_,{spinning:!0})}):e.jsx("div",{style:{color:"green"},children:"已完成"})]},s))})})]})]})};export{H as default};
