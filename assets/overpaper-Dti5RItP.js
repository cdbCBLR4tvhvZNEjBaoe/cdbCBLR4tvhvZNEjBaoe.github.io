import{r as i,j as e}from"./index-Bew0CJxr.js";import{I,B as g,S as $,J as F,A as L,W as G,C as R,a as A,G as O,b as z}from"./CardNFT-BOUXb_4i.js";const d={address:"0xdA06AC881996727863C8F4053450c114CF1aA147",abi:[{anonymous:!1,inputs:[{indexed:!1,internalType:"uint8",name:"version",type:"uint8"}],name:"Initialized",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"role",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"previousAdminRole",type:"bytes32"},{indexed:!0,internalType:"bytes32",name:"newAdminRole",type:"bytes32"}],name:"RoleAdminChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"role",type:"bytes32"},{indexed:!0,internalType:"address",name:"account",type:"address"},{indexed:!0,internalType:"address",name:"sender",type:"address"}],name:"RoleGranted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"bytes32",name:"role",type:"bytes32"},{indexed:!0,internalType:"address",name:"account",type:"address"},{indexed:!0,internalType:"address",name:"sender",type:"address"}],name:"RoleRevoked",type:"event"},{inputs:[],name:"DEFAULT_ADMIN_ROLE",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"DELEGATE_ROLE",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"MANAGER_ROLE",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"card",outputs:[{internalType:"contract IERC721Enumerable",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"factory",outputs:[{internalType:"contract ICardFactory",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"data",type:"bytes"},{internalType:"uint256",name:"startInNums",type:"uint256"},{internalType:"uint256",name:"lengthInNums",type:"uint256"},{internalType:"uint256",name:"totalNums",type:"uint256"}],name:"getAnswers",outputs:[{internalType:"bytes",name:"result",type:"bytes"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"}],name:"getRoleAdmin",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"},{internalType:"address",name:"account",type:"address"}],name:"grantRole",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"},{internalType:"address",name:"account",type:"address"}],name:"hasRole",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_factory",type:"address"},{internalType:"address",name:"_sellVault",type:"address"},{internalType:"address",name:"_token",type:"address"},{internalType:"address",name:"_usdt",type:"address"},{internalType:"address",name:"_card",type:"address"}],name:"initialize",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"},{internalType:"address",name:"account",type:"address"}],name:"renounceRole",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256[]",name:"tokenIds",type:"uint256[]"},{internalType:"address",name:"receiver",type:"address"}],name:"respondBtch",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"role",type:"bytes32"},{internalType:"address",name:"account",type:"address"}],name:"revokeRole",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"sellVault",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"token",outputs:[{internalType:"contract IERC20",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"usdt",outputs:[{internalType:"contract IERC20",name:"",type:"address"}],stateMutability:"view",type:"function"}]},K=()=>{const[r,M]=i.useState(""),[p,j]=i.useState(""),[C,T]=i.useState(new Map),[E,l]=i.useState(!1),[k,f]=i.useState(0),[S,x]=i.useState(!1),_=t=>{M(t.trim()),B()},P=t=>{j(t.trim())},B=()=>{T(new Map),f(0)},N=async()=>{var w;l(!0),x(!1);const t=new F(L),n=new G(r,t),o=new R(d.address,d.abi,n),u=new R(A.address,A.abi,n);await u.isApprovedForAll(n.address,d.address)?console.log(`${n.address} 已授权`):(await u.setApprovalForAll(d.address,!0),console.log(`${n.address} 授权完成`));const h=await v(n.address,0),a=new Map;for(let s=0;s<h.length;s++){const m=Number(h[s].tokenId),b=Math.floor(s/10);a.has(b)?(w=a.get(b))==null||w.push(m):a.set(b,[m])}T(a),console.log(a);let c=0;for(const s of a.values()){if(S){l(!1);break}c++,await(await o.respondBtch(s,p)).wait(),f(c),console.log(`${c} ${n.address} ->  ${s.length} ${s[s.length-1]}`)}l(!1)},v=async(t,n=0)=>new Promise(async o=>{const y=await(await fetch(O,{method:"POST",headers:{"Content-Type":"application/json",authorization:`Bearer ${z}`},body:JSON.stringify({query:`query MyQuery {
            papers(
              first: 1000
              orderBy: createAt
              skip: ${n}
              where: {user: "${t}", type: 0}
            ) {
              tokenId
            }
          }`})})).json();y.data.papers.length<1e3?o(y.data.papers):o(y.data.papers.concat(await v(t,n+1e3)))});return e.jsxs("div",{children:[e.jsxs("div",{className:"space-y-[20px]",children:[e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("div",{children:"私钥"}),e.jsx(I,{value:r,onChange:t=>_(t.target.value),style:{width:"400px"}})]}),e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("div",{children:"接收地址"}),e.jsx(I,{value:p,onChange:t=>P(t.target.value),style:{width:"400px"}})]})]}),e.jsxs("div",{children:[e.jsxs(g,{style:{width:"100px"},disabled:r==""||p=="",type:"primary",onClick:N,loading:E,children:[" ","开始答题"]}),e.jsxs(g,{style:{marginLeft:"20px",width:"100px"},disabled:r==""||p=="",type:"primary",onClick:()=>x(!0),children:[" ","暂停"]}),e.jsx("ul",{style:{marginTop:"20px"},children:e.jsx("ul",{children:Array.from(C,([t,n])=>e.jsxs("li",{children:[e.jsxs("div",{children:[e.jsxs("span",{style:{fontSize:"16px"},children:["第",t+1,"组"]}),": ",n.join(", ")]}),k<=t?e.jsx("div",{children:e.jsx($,{spinning:!0})}):e.jsx("div",{style:{color:"green"},children:"已完成"})]},t))})})]})]})};export{K as default};
